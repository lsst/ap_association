# Column names defined in http://ls.st/dpdd with some modification as needed
# by database schema defined in lsst.dax.apdb
funcs:
    diaSourceId: # the index of deepCoadd_disSource IS the diaSourceId
        functor: Column
        args: id
    visit:
        functor: Column
        args: visit
    detector:
        functor: Column
        args: detector
    band:
        functor: Column
        args: band
    diaObjectId:
        functor: Column
        args: diaObjectId
    ssObjectId:
        functor: Column
        args: ssObjectId
    parentDiaSourceId:
        functor: Column
        args: parent
    midpointMjdTai:
        functor: Column
        args: midpointMjdTai
    bboxSize:
        functor: Column
        args: bboxSize
    timeProcessedMjdTai:  # filled in automatically
        functor: Column
        args: timeProcessedMjdTai
    flags:
        functor: Column
        args: flags
    ra:
        functor: RAColumn
    dec:
        functor: DecColumn
    raErr:
        functor: RAErrColumn
    decErr:
        functor: DecErrColumn
    ra_dec_Cov:
        functor: RADecCovColumn
    x:
        functor: Column
        args: slot_Centroid_x
    y:
        functor: Column
        args: slot_Centroid_y
    xErr:
        functor: Column
        args: slot_Centroid_xErr
    yErr:
        functor: Column
        args: slot_Centroid_yErr
    apFlux:
        functor: LocalNanojansky
        args:
            - slot_ApFlux_instFlux
            - slot_ApFlux_instFluxErr
            - base_LocalPhotoCalib
    apFluxErr:
        functor: LocalNanojanskyErr
        args:
            - slot_ApFlux_instFlux
            - slot_ApFlux_instFluxErr
            - base_LocalPhotoCalib
    snr:
        functor: Column
        args: snr
    psfFlux:
        functor: LocalNanojansky
        args:
            - slot_PsfFlux_instFlux
            - slot_PsfFlux_instFluxErr
            - base_LocalPhotoCalib
    psfFluxErr:
        functor: LocalNanojanskyErr
        args:
            - slot_PsfFlux_instFlux
            - slot_PsfFlux_instFluxErr
            - base_LocalPhotoCalib
    # psfLnl not implemented
    psfChi2:
        functor: Column
        args: slot_PsfFlux_chi2
    psfNdata:
        functor: Column
        args: slot_PsfFlux_npixels
    trailFlux:
        functor: LocalNanojansky
        args:
            - ext_trailedSources_Naive_flux
            - ext_trailedSources_Naive_fluxErr
            - base_LocalPhotoCalib
    trailFluxErr:
        functor: LocalNanojanskyErr
        args:
            - ext_trailedSources_Naive_flux
            - ext_trailedSources_Naive_fluxErr
            - base_LocalPhotoCalib
    trailRa:
        functor: Column
        args: ext_trailedSources_Naive_ra
    trailDec:
        functor: Column
        args: ext_trailedSources_Naive_dec
    trailLength:
        functor: ConvertPixelToArcseconds
        args:
            - ext_trailedSources_Naive_length
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    trailAngle:
        functor: ConvertDetectorAngleToPositionAngle
        args:
            - ext_trailedSources_Naive_angle
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    trailAngleErr:
        functor: ConvertDetectorAngleErrToPositionAngleErr
        args:
            - ext_trailedSources_Naive_angle
            - ext_trailedSources_Naive_angleErr
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    # trailChi2 not implemented
    # trailNdata not implemented
    dipoleMeanFlux:
        functor: LocalDipoleMeanFlux
        args:
            - ip_diffim_DipoleFit_pos_instFlux
            - ip_diffim_DipoleFit_neg_instFlux
            - ip_diffim_DipoleFit_pos_instFluxErr
            - ip_diffim_DipoleFit_neg_instFluxErr
            - base_LocalPhotoCalib
    dipoleMeanFluxErr:
        functor: LocalDipoleMeanFluxErr
        args:
            - ip_diffim_DipoleFit_pos_instFlux
            - ip_diffim_DipoleFit_neg_instFlux
            - ip_diffim_DipoleFit_pos_instFluxErr
            - ip_diffim_DipoleFit_neg_instFluxErr
            - base_LocalPhotoCalib
    dipoleFluxDiff:
        functor: LocalDipoleDiffFlux
        args:
            - ip_diffim_DipoleFit_pos_instFlux
            - ip_diffim_DipoleFit_neg_instFlux
            - ip_diffim_DipoleFit_pos_instFluxErr
            - ip_diffim_DipoleFit_neg_instFluxErr
            - base_LocalPhotoCalib
    dipoleFluxDiffErr:
        functor: LocalDipoleDiffFluxErr
        args:
            - ip_diffim_DipoleFit_pos_instFlux
            - ip_diffim_DipoleFit_neg_instFlux
            - ip_diffim_DipoleFit_pos_instFluxErr
            - ip_diffim_DipoleFit_neg_instFluxErr
            - base_LocalPhotoCalib
    dipoleLength:
        functor: ConvertPixelToArcseconds
        args:
            - ip_diffim_DipoleFit_separation
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    dipoleAngle:
        functor: ConvertDetectorAngleToPositionAngle
        args:
            - ip_diffim_DipoleFit_orientation
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    dipoleChi2:
        functor: Column
        args: ip_diffim_DipoleFit_chi2dof
    isDipole:
        functor: Column
        args: ip_diffim_DipoleFit_classification
    isNegative:
        functor: Column
        args: is_negative
    dipoleFitAttempted:
        functor: Column
        args: ip_diffim_DipoleFit_classificationAttempted
    dipoleNdata:
        functor: Column
        args: ip_diffim_DipoleFit_nData
    scienceFlux:
        functor: LocalNanojansky
        args:
            - ip_diffim_forced_PsfFlux_instFlux
            - ip_diffim_forced_PsfFlux_instFluxErr
            - base_LocalPhotoCalib
    scienceFluxErr:
        functor: LocalNanojanskyErr
        args:
            - ip_diffim_forced_PsfFlux_instFlux
            - ip_diffim_forced_PsfFlux_instFluxErr
            - base_LocalPhotoCalib
    templateFlux:
        functor: LocalNanojansky
        args:
            - ip_diffim_forced_template_PsfFlux_instFlux
            - ip_diffim_forced_template_PsfFlux_instFluxErr
            - base_LocalPhotoCalib
    templateFluxErr:
        functor: LocalNanojanskyErr
        args:
            - ip_diffim_forced_template_PsfFlux_instFlux
            - ip_diffim_forced_template_PsfFlux_instFluxErr
            - base_LocalPhotoCalib
    ixx:
        functor: ConvertPixelSqToArcsecondsSq
        args:
            - slot_Shape_xx
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    iyy:
        functor: ConvertPixelSqToArcsecondsSq
        args:
            - slot_Shape_yy
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    ixy:
        functor: ConvertPixelSqToArcsecondsSq
        args:
            - slot_Shape_xy
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    ixxPSF:
        functor: ConvertPixelSqToArcsecondsSq
        args:
            - slot_PsfShape_xx
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    iyyPSF:
        functor: ConvertPixelSqToArcsecondsSq
        args:
            - slot_PsfShape_yy
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    ixyPSF:
        functor: ConvertPixelSqToArcsecondsSq
        args:
            - slot_PsfShape_xy
            - base_LocalWcs_CDMatrix_1_1
            - base_LocalWcs_CDMatrix_1_2
            - base_LocalWcs_CDMatrix_2_1
            - base_LocalWcs_CDMatrix_2_2
    extendedness:
        functor: Column
        args: base_ClassificationSizeExtendedness_value
    reliability:
        functor: Column
        args: reliability
    glint_trail:
        functor: Column
        args: glint_trail
